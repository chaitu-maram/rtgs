<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Axis Bank RTGS/NEFT/IMPS Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hover-gradient {
      position: relative;
      overflow: hidden;
      background: white;
      color: #1f2937;
      border: 1px solid #e5e7eb;
      transition: transform 0.2s ease;
    }
    .hover-gradient::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, #be123c, #db2777);
      transition: all 0.4s ease;
      z-index: 0;
    }
    .hover-gradient:hover::before {
      left: 0;
    }
    .hover-gradient:hover {
      color: white;
      transform: translateX(4px);
    }
    .hover-gradient > * {
      position: relative;
      z-index: 10;
    }
    input:focus,
    select:focus,
    textarea:focus {
      outline: none !important;
      border-color: #db2777 !important;
      box-shadow: 0 0 0 2px #db2777 !important;
    }

    /* Please Wait Modal */
    #pleaseWaitModal {
      background-color: rgba(219, 39, 119, 0.4);
    }
    #pleaseWaitModal > div {
      background: white;
      border-radius: 0.5rem;
      padding: 2rem;
      box-shadow: 0 10px 15px rgba(219, 39, 119, 0.4);
      max-width: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Wave animation */
    #wave1, #wave2 {
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      animation-name: waveMove;
      animation-duration: 4000ms;
    }
    #wave2 {
      animation-direction: reverse;
      animation-duration: 6000ms;
    }
    @keyframes waveMove {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* Beneficiary autocomplete dropdown */
    .ben-dropdown {
      position: absolute;
      z-index: 60;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      max-height: 12rem;
      overflow-y: auto;
      box-shadow: 0 10px 15px rgba(0,0,0,0.05);
    }
    .ben-dropdown li {
      padding: 0.5rem 0.75rem;
      cursor: pointer;
    }
    .ben-dropdown li:hover {
      background-color: rgba(236, 72, 153, 0.06);
    }
    /* scrollbar */
    .ben-dropdown::-webkit-scrollbar { width: 6px; }
    .ben-dropdown::-webkit-scrollbar-thumb { background: rgba(219,39,119,0.6); border-radius: 10px; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex font-sans">

  <!-- Sidebar -->
  <!-- <aside class="w-64 bg-gradient-to-b from-rose-900 to-white text-white h-screen fixed top-0 left-0 p-6 flex flex-col space-y-8 shadow-lg">
    <div class="flex justify-start items-center space-x-2">
      <img src="/media/logo.png" alt="Logo" class="h-8 w-auto rounded" />
    </div>
    <div class="grid grid-cols-1 gap-2">
      <a href="{% url 'union_bank' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <img src="/media/union.png" alt="Union Bank" class="h-8 w-8 object-contain flex-shrink-0" />
        <span class="text-sm font-medium">UNION BANK</span>
      </a>
      <a href="#" class="coming-soon hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <img src="/media/kotak.png" alt="Kotak Bank" class="h-8 w-8 object-contain flex-shrink-0" />
        <span class="text-sm font-medium">KOTAK BANK</span>
      </a>
      <a href="#" class="coming-soon hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <img src="/media/sbi.png" alt="SBI" class="h-8 w-8 object-contain flex-shrink-0" />
        <span class="text-sm font-medium">SBI BANK</span>
      </a>
      <a href="#" class="coming-soon hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <img src="/media/hdfc.png" alt="HDFC" class="h-8 w-8 object-contain flex-shrink-0" />
        <span class="text-sm font-medium">HDFC BANK</span>
      </a>
      <a href="#" class="coming-soon hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <img src="/media/icici.png" alt="ICICI Bank" class="h-8 w-8 object-contain flex-shrink-0" />
        <span class="text-sm font-medium">ICICI BANK</span>
      </a>
    </div>
  </aside> -->



  <aside class="w-64 bg-gradient-to-b from-rose-900 to-white text-white h-screen fixed top-0 left-0 p-6 flex flex-col space-y-8 shadow-lg">
  <div class="flex justify-start items-center space-x-2">
    <img src="/media/logo.png" alt="Logo" class="h-8 w-auto rounded" />
  </div>

  <div class="grid grid-cols-1 gap-2">
    <a href="{% url 'select_specific_bank' 'union' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
      <img src="/media/union.png" alt="Union Bank" class="h-8 w-8 object-contain flex-shrink-0" />
      <span class="text-sm font-medium">UNION BANK</span>
    </a>

    <a href="{% url 'select_specific_bank' 'axis' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
      <img src="/media/axis.png" alt="Axis Bank" class="h-8 w-8 object-contain flex-shrink-0" />
      <span class="text-sm font-medium">AXIS BANK</span>
    </a>

    <a href="{% url 'select_specific_bank' 'sbi' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
      <img src="/media/sbi.png" alt="SBI" class="h-8 w-8 object-contain flex-shrink-0" />
      <span class="text-sm font-medium">SBI BANK</span>
    </a>

    <a href="{% url 'select_specific_bank' 'hdfc' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
      <img src="/media/hdfc.png" alt="HDFC Bank" class="h-8 w-8 object-contain flex-shrink-0" />
      <span class="text-sm font-medium">HDFC BANK</span>
    </a>

    <a href="{% url 'select_specific_bank' 'icici' %}" class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
      <img src="/media/icici.png" alt="ICICI Bank" class="h-8 w-8 object-contain flex-shrink-0" />
      <span class="text-sm font-medium">ICICI BANK</span>
    </a>


    <!-- üîÅ Go to Select Bank -->
      <a href="{% url 'select_bank' %}"
         class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md">
        <svg xmlns="http://www.w3.org/2000/svg" 
             class="w-5 h-5"
             fill="none" 
             viewBox="0 0 24 24"
             stroke="currentColor"
             stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 12h18M3 17h18" />
        </svg>
        <span class="font-medium">Select Bank Accounts</span>
      </a>

      <form action="{% url 'logout' %}" method="post" class="w-full">
  {% csrf_token %}
  <button type="submit"
          class="hover-gradient grid grid-cols-[32px_1fr] items-center gap-3 p-3 rounded-md w-full text-left">
    <svg xmlns="http://www.w3.org/2000/svg"
         class="w-5 h-5 text-black-600"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor"
         stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m0-10V5m0 0a2 2 0 00-2 2v1m0 10v1a2 2 0 002 2h5a2 2 0 002-2v-1" />
    </svg>
    <span class="font-medium text-black-600">Logout</span>
  </button>
</form>




  </div>
</aside>


  <!-- Main Content -->
  <div class="flex-1 flex flex-col ml-64">
    <header class="bg-gradient-to-r from-white to-pink-900 text-white px-6 py-4 flex justify-end items-center shadow-md">
      <img src="/media/logo.png" alt="Logo" class="h-10 w-auto rounded" />
    </header>

    <main class="flex items-center justify-center flex-1 p-8">
      <div class="bg-white p-10 rounded-xl shadow-xl w-full max-w-6xl border border-gray-200">
        <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-rose-900 to-pink-700 text-transparent bg-clip-text">
          Axis Bank RTGS / NEFT / IMPS Form
        </h2>

        <form method="POST" action="{% url 'axis_bank' %}"  onsubmit="showPleaseWait()">
          {% csrf_token %}

          

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {% for field in form %}
              {% if field.name == 'date' %}
              <div class="col-span-3">
                <h3 class="text-xl font-semibold text-rose-800 border-b-2 border-rose-700 pb-1 mb-4">Section 1: General Details</h3>
              </div>
              {% endif %}

              {% if field.name == 'remitter_account_number' %}
              <div class="col-span-3 mt-6">
                <h3 class="text-xl font-semibold text-rose-800 border-b-2 border-rose-700 pb-1 mb-4">Section 2: Remitter Details</h3>
              </div>
              {% endif %}

              {% if field.name == 'beneficiary_account_number' %}
              <div class="col-span-3 mt-6">
                <h3 class="text-xl font-semibold text-rose-800 border-b-2 border-rose-700 pb-1 mb-4">Section 3: Beneficiary Details</h3>
              </div>
              <!-- ===== Beneficiary Autocomplete UI NOTE: placed before generating the fields so user sees it early ===== -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Beneficiary (search by name or account)</label>
            <div class="relative">
              <input id="id_beneficiary_name_search" type="text" placeholder="Type beneficiary name or account to search"
                     class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
              <!-- dropdown container -->
              <ul id="beneficiarySearchDropdown" class="ben-dropdown hidden"></ul>
            </div>
            <p class="text-xs text-gray-500 mt-1">Select a suggestion to auto-fill beneficiary fields below.</p>
          </div>
              {% endif %}
              

              {% if field.name == 'sender_to_receiver_information' %}
              <div class="col-span-3 mt-6">
                <h3 class="text-xl font-semibold text-rose-800 border-b-2 border-rose-700 pb-1 mb-4">Section 4: Sender to Receiver Information</h3>
              </div>
              {% endif %}

              <div class="{% if field.name == 'sender_to_receiver_information' %}col-span-3{% endif %}">
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                <p class="text-red-500 text-sm mt-1">{{ field.errors|striptags }}</p>
                {% endif %}
              </div>
            {% endfor %}
          </div>

          <div class="flex justify-center pt-6">
            <button type="submit" class="bg-rose-800 text-white px-8 py-3 rounded-full hover:bg-rose-900 transition duration-200 shadow-md font-semibold tracking-wide">
              üìù Generate Form
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Please Wait Modal -->
  <div id="pleaseWaitModal" class="fixed inset-0 flex items-center justify-center hidden z-50">
    <div>
      <svg viewBox="0 0 100 100" width="80" height="80" class="mb-6">
        <defs><clipPath id="circleClip"><circle cx="50" cy="50" r="45" /></clipPath></defs>
        <circle cx="50" cy="50" r="45" fill="none" stroke="#db2777" stroke-width="5" />
        <g clip-path="url(#circleClip)">
          <path id="wave1" fill="#f43f5e" opacity="0.6" d="M0 50 Q25 30 50 50 T100 50 V100 H0 Z"></path>
          <path id="wave2" fill="#ec4899" opacity="0.6" d="M0 50 Q25 70 50 50 T100 50 V100 H0 Z"></path>
        </g>
      </svg>
      <p class="text-rose-900 font-semibold text-lg select-none text-center">Please wait...</p>
    </div>
  </div>

  <!-- Coming Soon Modal -->
  <div id="comingSoonModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
    <div class="bg-white rounded-lg p-8 max-w-sm w-full shadow-lg text-center relative">
      <button id="closeModalBtn" class="absolute top-3 right-3 text-pink-500 hover:text-pink-900 text-xl font-bold">&times;</button>
      <h3 class="text-2xl font-bold mb-4 text-pink-700">Coming Soon!</h3>
      <p class="text-gray-700 mb-6">This bank hasn't been added yet. <br> Stay tuned!</p>
      <button id="modalOkBtn" class="bg-pink-700 hover:bg-pink-800 text-white font-semibold py-2 px-6 rounded">OK</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Autofill from URL params (kept as you had)
      const params = new URLSearchParams(window.location.search);
      const fields = {
        remitter_name: "id_remitter_name",
        remitter_account_number: "id_remitter_account_number",
        remitter_address: "id_remitter_address",
        remitter_branch: "id_branch",
        remitter_pan: "id_pan_no",
        remitter_mobile: "id_mobile_number",
        remitter_other: "id_other_number",
      };
      for (const [key, id] of Object.entries(fields)) {
        const el = document.getElementById(id);
        if (el && params.get(key)) el.value = params.get(key);
      }

      // Please Wait Modal
      const form = document.querySelector('form');

      form.addEventListener('submit', function () {
        const modal = document.getElementById('pleaseWaitModal');
        modal.classList.remove('hidden');

        // Hide the modal automatically after 2.5 seconds
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 600);
      });

      // Coming Soon Modal
      const comingButtons = document.querySelectorAll(".coming-soon");
      const comingModal = document.getElementById("comingSoonModal");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const modalOkBtn = document.getElementById("modalOkBtn");

      comingButtons.forEach(btn => {
        btn.addEventListener("click", e => {
          e.preventDefault();
          comingModal.classList.remove("hidden");
        });
      });

      closeModalBtn.addEventListener("click", () => comingModal.classList.add("hidden"));
      modalOkBtn.addEventListener("click", () => comingModal.classList.add("hidden"));

      // ---------------------- Beneficiary Autocomplete ----------------------
      const searchInput = document.getElementById("id_beneficiary_name_search");
      const dropdown = document.getElementById("beneficiarySearchDropdown");
      let debounceTimer;

      // Helper to safely set field values
      function safeSet(id, value) {
        const el = document.getElementById(id);
        if (el) el.value = value || "";
      }

      searchInput.addEventListener("input", function () {
        const query = this.value.trim();
        clearTimeout(debounceTimer);

        if (!query) {
          dropdown.classList.add("hidden");
          dropdown.innerHTML = "";
          return;
        }

        debounceTimer = setTimeout(() => {
          fetch(`/fetch-beneficiaries/?q=${encodeURIComponent(query)}`)
            .then(res => res.json())
            .then(data => {
              const results = data.results || [];
              dropdown.innerHTML = "";

              if (results.length === 0) {
                dropdown.innerHTML = `<li class="text-gray-500">No results found</li>`;
                dropdown.classList.remove("hidden");
                return;
              }

              results.forEach(b => {
                const li = document.createElement("li");
                // show name and account for clarity
                li.innerHTML = `<div class="font-medium text-sm">${escapeHtml(b.name || '')}</div>
                                <div class="text-xs text-gray-500">${escapeHtml(b.account_number || '')} ‚Ä¢ ${escapeHtml(b.ifsc_code || '')}</div>`;
                li.addEventListener("click", () => {
                  // Fill the form fields (IDs come from your Django form fields)
                  safeSet("id_beneficiary_name", b.name || "");
                  safeSet("id_beneficiary_account_number", b.account_number || "");
                  safeSet("id_beneficiary_bank_name", b.bank_name || "");
                  safeSet("id_beneficiary_bank_ifsc_code", b.ifsc_code || "");
                  safeSet("id_beneficiary_bank_address", b.bank_address || "");
                  safeSet("id_beneficiary_LEI_code", b.lei_code || "");
                  // Also copy into search input for clarity
                  searchInput.value = b.name || (b.account_number || "");
                  dropdown.classList.add("hidden");
                });
                dropdown.appendChild(li);
              });

              dropdown.classList.remove("hidden");
            })
            .catch(err => {
              console.error("Error fetching beneficiaries:", err);
              dropdown.innerHTML = `<li class="text-gray-500">Error fetching results</li>`;
              dropdown.classList.remove("hidden");
            });
        }, 250); // debounce for smoother typing
      });

      // Hide dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!searchInput.parentNode.contains(e.target)) {
          dropdown.classList.add("hidden");
        }
      });

      // Basic HTML-escape helper
      function escapeHtml(text) {
        if (!text) return "";
        return text.replace(/[&<>"']/g, function(m) {
          return {"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m];
        });
      }

      // (Optional) Pressing down arrow focuses first suggestion
      searchInput.addEventListener("keydown", function(e) {
        if (e.key === "ArrowDown") {
          const first = dropdown.querySelector("li");
          if (first) {
            first.focus();
            // make it tabbable
            first.setAttribute("tabindex", "-1");
            first.scrollIntoView({block: "nearest"});
          }
        }
      });

    });


    // ---------------------- Auto-refresh after document download ----------------------
const checkDownload = setInterval(() => {
  if (document.cookie.includes("fileDownload=true")) {
    // remove the temporary cookie
    document.cookie = "fileDownload=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    
    // ‚úÖ Refresh the page ‚Äî keeps remitter details (loaded from session)
    // and clears beneficiary details
    window.location.reload();
    
    clearInterval(checkDownload);
  }
}, 1000);

  </script>
</body>
</html>
